<% messages.each do |message| %>
  <% if message.role == "user" %>
    <div class="d-flex justify-content-end mb-2">
      <div class="bg-white px-3 pb-0 pt-3 rounded-pill">
        <%= raw(render_markdown(message.content)) %>
      </div>
    </div>
  <% elsif message.role == "assistant" %>
    <% parsed = JSON.parse(message.content) rescue nil %>
    <div class="d-flex justify-content-start mb-5">
      <div class="px-3 pb-0 pt-3">
        <% if parsed.present? && parsed["html"].present? && parsed["css"].present? %>
          <div class="row">
            <div class="col-4">
              <h5>HTML</h5>
              <pre><code><%= parsed["html"] %></code></pre>
              <h5>CSS</h5>
              <pre><code><%= parsed["css"] %></code></pre>
            </div>
            <div class="col-8">
              <iframe
                srcdoc="<style><%= parsed['css'] %></style><%= parsed['html'] %>"
              style="width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 8px;">
            </iframe>
          </div>
        </div>
      <% else %>
        <%= raw(render_markdown(message.content)) %>
      <% end %>
    </div>
  </div>
<% end %>
<% end %>
